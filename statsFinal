#!/usr/bin/env bash

statsDirectory=$1
summaryName=$2
singleSummaryName=$3
configFile=$4

summaryFile="$statsDirectory/$summaryName"

totalWrite=0
totalRmdir=0
totalForget=0
maxFTCthreshold=0
maxSMthreshold=0
maxSEthreshold=0
maxFDthreshold=0
maxSKthreshold=0
totalWriteRisk=0
totalRmdirRisk=0
totalForgetRisk=0
totalRisk=0
{ IFS= read -rd '' config <$configFile;} 2>/dev/null
config=`echo "$config" | sed -e 's/^/| /'`
config=`echo "${config//;}"`
config=`echo "$config" | tr "," " || "`

writeRegex="| Write                  | ([0-9^]+)"
rmdirRegex="| Rmdir                  | ([0-9^]+)"
forgetRegex="| Forget                 | ([0-9^]+)"
resWriteRegex="| Resolutions - Write"
resRmdirRegex="| Resolutions - Rmdir"
resForgetRegex="| Resolutions - Forget"
ftcRegex="| File type changes      | ([0-9^]+)"
smeRegex="| Similarity Measurement | ([0-9^]+)"
sheRegex="| Shannon Enthropy       | ([0-9^]+)"
fidRegex="| Files Deletion         | ([0-9^]+)"
sukRegex="| Suspicious Keywords    | ([0-9^]+)"

# 0 = not set | 1 = WRITE | 2 = FORGET | 3 = RMDIR
context=0

filesName="$statsDirectory/*/$singleSummaryName"
summaryFiles=(`ls $filesName`)

for runResultsFile in $summaryFiles
do
    while IFS= read -r summaryLine
    do
        if [[ $summaryLine =~ $writeRegex ]]; then
            echo "xxxxxx"

    #    elif [[ $summaryLine =~ $rmdirRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $forgetRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $resWriteRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $resRmdirRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $resForgetRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $ftcRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $smeRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $sheRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $fidRegex ]]; then
    #        echo $summaryLine

    #    elif [[ $summaryLine =~ $sukRegex ]]; then
    #        echo $summaryLine

        fi
    done < "$runResultsFile"
done

summaryTemplate="|----------------------------------------\n| Demo Summary\n|----------------------------------------\n| Demo Configurations:\n|----------------------------------------\n$config\n|----------------------------------------\n| Action name            | Total count\n|----------------------------------------\n| Write                  | $totalWrite\n| Rmdir                  | $totalRmdir\n| Forget                 | $totalForget\n|----------------------------------------\n| Heuristic name         | Max threshold\n|----------------------------------------\n| File type changes      | $maxFTCthreshold\n| Similarity Measurement | $maxSMthreshold\n| Shannon Enthropy       | $maxSEthreshold\n| Files Deletion         | $maxFDthreshold\n| Suspicious Keywords    | $maxSKthreshold\n|----------------------------------------\n| Resolutions\n|----------------------------------------\n| Action name            | Total Risk\n|----------------------------------------\n| Write                  | $totalWriteRisk\n| Rmdir                  | $totalRmdirRisk\n| Forget                 | $totalForgetRisk\n| Total                  | $totalRisk\n|----------------------------------------\n"
sudo touch $summaryFile
sudo chmod 777 $summaryFile
sudo echo -en "$summaryTemplate" > $summaryFile